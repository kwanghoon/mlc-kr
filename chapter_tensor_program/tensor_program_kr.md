## 원시 텐서 함수

소개 개요에서 MLC 프로세스가 텐서 함수 간의 변환으로 볼 수 있음을 보여주었습니다. 일반적인 모델 실행은 입력에서 최종 예측까지 텐서를 변환하는 여러 계산 단계를 포함하며, 각 단위 단계를 원시 텐서 함수(primitive tensor function)라고 합니다.

![원시 텐서 함수](../img/primitive_tensor_func.png)
:label:`fig_primitive_tensor_func`

위 그림에서 텐서 연산자 linear, add, relu, softmax는 모두 원시 텐서 함수입니다. 특히, 많은 다른 추상화들이 동일한 원시 텐서 함수 add를 표현(그리고 구현)할 수 있습니다(아래 그림 참조). 우리는 사전 구축된 프레임워크 라이브러리(예: torch.add 또는 numpy.add)를 호출하고 Python으로 구현된 것을 활용할 수 있습니다. 실제로 원시 함수들은 C/C++와 같은 저수준 언어로 구현되며 때로는 어셈블리 코드가 혼합되기도 합니다.

![동일한 원시 텐서 함수의 다양한 형태](../img/tensor_func_abstractions.png)
:label:`fig_tensor_func_abstractions`

많은 프레임워크들은 원시 텐서 함수를 특정 작업 부하와 배포 환경에 맞는 보다 특화된 것으로 변환하는 머신러닝 컴파일 절차를 제공합니다.

![원시 텐서 함수 간의 변환](../img/tensor_func_transformation.png)
:label:`fig_tensor_func_transformation`

위 그림은 원시 텐서 함수 add의 구현이 다른 구현으로 변환되는 예를 보여줍니다. 오른쪽의 특정 코드는 가능한 최적화 세트를 나타내는 의사 코드입니다: 루프가 길이 `4`의 단위로 분할되며, 여기서 `f32x4` add는 계산을 수행하는 특수 벡터 덧셈 함수에 해당합니다.

## 텐서 프로그램 추상화

이전 섹션에서는 원시 텐서 함수를 변환할 필요성에 대해 이야기했습니다. 이를 효과적으로 수행하려면 프로그램을 표현하기 위한 효과적인 추상화가 필요합니다.

일반적으로 원시 텐서 함수 구현을 위한 전형적인 추상화는 다음 요소들을 포함합니다: 다차원 버퍼, 텐서 계산을 구동하는 루프 중첩, 그리고 마지막으로 계산 구문 자체입니다.

![원시 텐서 함수의 전형적인 요소들](../img/tensor_func_elements.png)
:label:`fig_tensor_func_elements`

우리는 이러한 유형의 추상화를 텐서 프로그램 추상화라고 부릅니다. 텐서 프로그램 추상화의 중요한 속성 중 하나는 일련의 변환을 통해 프로그램을 실용적으로 변경할 수 있는 능력입니다.

![원시 텐서 함수에 대한 순차적 변환](../img/tensor_func_seq_transform.png)
:label:`fig_tensor_func_seq_transform`

예를 들어, 우리는 변환 기본 요소들(split, parallelize, vectorize)의 세트를 사용하여 초기 루프 프로그램을 가져와서 오른쪽의 프로그램으로 변환할 수 있어야 합니다.

### 텐서 프로그램 추상화의 추가 구조

중요한 것은, 일부 계산이 루프의 순서에 의존하기 때문에 프로그램에 대해 임의의 변환을 수행할 수 없다는 것입니다. 다행히도, 우리가 관심 있는 대부분의 원시 텐서 함수들은 좋은 속성(예: 루프 반복 간의 독립성)을 가지고 있습니다.

텐서 프로그램은 프로그램 변환을 용이하게 하기 위해 이러한 추가 정보를 프로그램의 일부로 통합할 수 있습니다.

![반복은 텐서 프로그램의 추가 정보입니다](../img/tensor_func_iteration.png)
:label:`fig_tensor_func_iteration`

예를 들어, 위 프로그램은 추가적인 `T.axis.spatial` 어노테이션을 포함하고 있으며, 이는 특정 변수 `vi`가 `i`에 매핑되고 모든 반복이 독립적임을 보여줍니다. 이 정보는 특정 프로그램을 실행하는 데 필수적이지는 않지만 프로그램을 변환할 때 유용합니다. 이 경우, `0`부터 `128`까지의 모든 인덱스 요소를 방문하는 한 `vi`와 관련된 루프를 안전하게 병렬화하거나 재정렬할 수 있다는 것을 알 수 있습니다.


## 요약

- 원시 텐서 함수는 모델 실행에서 단일 계산 단위를 의미합니다.

  - MLC 프로세스는 원시 텐서 함수의 구현을 변환하도록 선택할 수 있습니다.
- 텐서 프로그램은 원시 텐서 함수를 표현하는 효과적인 추상화입니다.
  - 핵심 요소는 다음을 포함합니다: 다차원 버퍼, 루프 중첩, 계산 구문.
  - 프로그램 기반 변환을 사용하여 텐서 프로그램을 최적화할 수 있습니다.
  - 추가 구조는 변환에 더 많은 정보를 제공하는 데 도움이 될 수 있습니다.
